{"version":3,"sources":["fixedWindowLimiter.js"],"names":["FixedWindowLimiter","RateLimiter","tokensPerInterval","interval","Date","count"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,YAAA,GAAA,sBAAA,CAAA,OAAA,CAAA,kBAAA,CAAA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IACaA,kB;;;;;AACX,WAAA,kBAAA,CAAA,IAAA,EAGG;AAAA,QAAA,KAAA;;AAAA,QAFDE,iBAEC,GAAA,IAAA,CAFDA,iBAEC;AAAA,QADDC,QACC,GAAA,IAAA,CADDA,QACC;;AAAA,IAAA,eAAA,CAAA,IAAA,EAAA,kBAAA,CAAA;;AACD,IAAA,KAAA,GAAA,MAAA,CAAA,IAAA,CAAA,IAAA,EAAM;AACJD,MAAAA,iBAAiB,EADb,iBAAA;AAEJC,MAAAA,QAAQ,EAARA;AAFI,KAAN,CAAA;AAIA,IAAA,KAAA,CAAA,UAAA,GAAA,CAAA;AALC,WAAA,KAAA;AAMF;;;;WAED,SAAA,UAAA,GAAa;AACX,WAAA,eAAA,GAAA,EAAA;;AAEA,UAAIC,IAAI,CAAJA,GAAAA,MAAc,KAAlB,UAAA,EAAmC;AACjC,aAAA,MAAA,GAAc,KAAd,iBAAA;AACA,aAAA,UAAA,GAAkBA,IAAI,CAAJA,GAAAA,KAAa,KAA/B,QAAA;AACD;;AAED,aAAO,KAAP,MAAA;AACD;;;WAED,SAAA,iBAAA,GAA6B;AAAA,UAAXC,KAAW,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,IAAA,SAAA,CAAA,CAAA,CAAA,KAAA,SAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAH,CAAG;;AAC3B,UAAIA,KAAK,GAAG,KAAZ,iBAAA,EAAoC;AAClC,cAAM,IAAA,KAAA,CAAA,iBAAA,MAAA,CAAA,KAAA,EAAA,8CAAA,EAAA,MAAA,CAA+E,KAArF,iBAAM,CAAA,CAAN;AACD;;AAED,WAAA,UAAA;;AAEA,UAAIA,KAAK,IAAI,KAAb,MAAA,EAA0B;AACxB,eAAA,CAAA;AACD;;AAED,aAAO,KAAA,UAAA,GAAkBD,IAAI,CAA7B,GAAyBA,EAAzB;AACD;;;;EAnCqCH,YAAAA,CAAAA,SAAAA,C","sourcesContent":["import RateLimiter from './rateLimiter.js';\nexport class FixedWindowLimiter extends RateLimiter {\n  constructor({\n    tokensPerInterval,\n    interval\n  }) {\n    super({\n      tokensPerInterval,\n      interval\n    });\n    this.nextDripAt = 0;\n  }\n\n  dripTokens() {\n    this.tokensRemovedAt = [];\n\n    if (Date.now() >= this.nextDripAt) {\n      this.tokens = this.tokensPerInterval;\n      this.nextDripAt = Date.now() + this.interval;\n    }\n\n    return this.tokens;\n  }\n\n  getDelayForTokens(count = 1) {\n    if (count > this.tokensPerInterval) {\n      throw new Error(`Cannot supply ${count} tokens at once (max is tokensPerInterval = ${this.tokensPerInterval}`);\n    }\n\n    this.dripTokens();\n\n    if (count <= this.tokens) {\n      return 0;\n    }\n\n    return this.nextDripAt - Date.now();\n  }\n\n}"],"file":"fixedWindowLimiter.js"}