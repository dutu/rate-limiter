{"version":3,"sources":["rateLimiter.js"],"names":["RateLimiter","tokensPerInterval","interval","Math","count","Date","delayMs","setTimeout","resolve"],"mappings":"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","sourcesContent":["export default class RateLimiter {\n  constructor({\n    tokensPerInterval,\n    interval\n  }) {\n    this.tokensPerInterval = tokensPerInterval;\n\n    if (typeof interval === 'string') {\n      switch (interval) {\n        case 'sec':\n        case 'second':\n          {\n            this.interval = 1000;\n            break;\n          }\n\n        case 'min':\n        case 'minute':\n          {\n            this.interval = 1000 * 60;\n            break;\n          }\n\n        case 'hr':\n        case 'hour':\n          {\n            this.interval = 1000 * 60 * 60;\n            break;\n          }\n\n        case 'day':\n          {\n            this.interval = 1000 * 60 * 60 * 24;\n            break;\n          }\n\n        default:\n          throw new Error('Invalid interval ' + interval);\n      }\n    } else {\n      this.interval = interval;\n    }\n\n    this.tokensRemovedAt = [];\n  }\n\n  dripTokens() {\n    throw new Error(`dripTokens() not implemented`);\n  }\n\n  getDelayForTokens() {\n    throw new Error(`getDelayForTokens() not implemented`);\n  }\n\n  getTokens() {\n    this.dripTokens();\n    return Math.floor(this.tokens);\n  }\n\n  tryRemoveTokens(count) {\n    this.dripTokens();\n    if (count > this.tokens) return false;\n    this.tokens -= count;\n    this.tokensRemovedAt.push([Date.now(), count]);\n    return true;\n  }\n\n  async awaitTokens(count = 1) {\n    let delayMs = this.getDelayForTokens(count);\n\n    if (delayMs === 0) {\n      return Math.floor(this.tokens);\n    }\n\n    await new Promise(resolve => setTimeout(() => resolve(), delayMs));\n    return this.awaitTokens(count);\n  }\n\n}"],"file":"rateLimiter.js"}